<div class="transaction-review-container">
  <ng-container *ngIf="action && currentActionDisplay; else noAction">
    <div class="transaction-header">
      <h2 *ngIf="isActionHasPriorityFee">Transaction Review</h2>
      <h2 *ngIf="!isActionHasPriorityFee">Action Review</h2>
      <p>Please review the details below before proceeding.</p>
    </div>

    <h3>{{ currentActionDisplay.title }}</h3>
    <h4 *ngIf="currentActionDisplay.subtitle">{{ currentActionDisplay.subtitle }}</h4>
    <div [ngClass]="{'detail': !row.isCodeBlock, 'detail-signing-message': row.isCodeBlock}"
      *ngFor="let row of currentActionDisplay.rows">
      <div class="label">{{ row.fieldName }}:</div>
      <div class="value">{{ row.fieldValue }}</div>
    </div>

    <!-- <ng-container *ngIf="action?.type === WalletActionType.TRANSFER_KAS">


      <ng-container *ngIf="
          krc20ActionData.operationData.op === KRC20OperationType.SEND &&
          krc20ActionData.isCancel
        ">
        <h3>Cancel KRC20 Token Listing</h3>
        <div class="transaction-details">
          <div class="detail">
            <div class="label">Ticker:</div>
            <div class="value">{{ krc20ActionData.operationData.tick.toUpperCase() }}</div>
          </div>
          <div class="detail">
            <div class="label">Wallet:</div>
            <div class="value">{{ walletAddress }}</div>
          </div>
          <div class="detail">
            <div class="label">Amount:</div>
            <div class="value">
              {{ krc20ActionData.amount! | sompiToNumber }}
            </div>
          </div>
        </div>
      </ng-container>

      <div class="transaction-operation-data-details">
        <div class="detail">
          <div class="label">Operation Data:</div>
          <div class="value">
            <pre>{{ krc20ActionData.operationData | json }}</pre>
          </div>
        </div>
      </div>
    </ng-container>

    <ng-container *ngIf="action?.type === WalletActionType.COMMIT_REVEAL">

      <ng-container *ngIf="krc20ActionData?.isCancel; else listingTemplate">
        <h3>Cancel KRC20 Token Listing</h3>
      </ng-container>
      <ng-template #listingTemplate>
        <h3>List KRC20 Token</h3>
      </ng-template>

      <h3>Do Protocol Action</h3>
      <div class="detail">
        <div class="label">Wallet:</div>
        <div class="value">{{ walletAddress }}</div>
      </div>
      <div class="detail">
        <div class="label">Protocol:</div>
        <div class="value">{{ commitRevealActionData?.actionScript?.scriptProtocol || '-' }}</div>
      </div>
      <div class="detail-signing-message">
        <div class="label">Action:</div>
        <div class="value">{{ commitRevealActionData?.actionScript?.scriptDataStringify || '-'}}</div>
      </div>
    </ng-container>

    <ng-container *ngIf="action?.type === WalletActionType.BUY_KRC20_PSKT">
      <h3>Buy KRC20 Token Transaction</h3>
      <div class="detail">
        <div class="label">Wallet:</div>
        <div class="value">{{ walletAddress }}</div>
      </div>
      <div *ngFor="let output of buyKrc20PsktTransactoin.outputs">
        <div class="detail">
          <div class="label">Amount:</div>
          <div class="value">{{ output.value | sompiToNumber }} KAS</div>
        </div>
        <div class="detail">
          <div class="label">To:</div>
          <div class="value">{{ output.scriptPublicKey }}</div>
        </div>
      </div>
    </ng-container> -->


    <priority-fee-selection *ngIf="isActionHasPriorityFee" [action]="action" [wallet]="wallet"
      (priorityFeeSelected)="setCurrentPriorityFee($event)"></priority-fee-selection>

    <div class="transaction-actions">
      <button class="accept-btn" (click)="acceptTransaction()" [disabled]="!isAvailableForApproval()">Accept</button>
      <button class="reject-btn" (click)="rejectTransaction()">Reject</button>
    </div>
  </ng-container>

  <ng-template #noAction>
    <ng-container *ngIf="showLoader || result; else noActionToShow">
      <ng-container *ngIf="showLoader">
        <p *ngIf="!result">Performing action...</p>
        <p *ngIf="result">Action Completed</p>
        <div class="progress-container">
          <div class="progress-bar" [style.width.%]="progress"></div>
          <div class="progress-label">{{ progress }}%</div>
        </div>
      </ng-container>

      <ng-container *ngIf="result">
        <completed-action-review [actionResult]="result"></completed-action-review>
      </ng-container>
    </ng-container>

    <ng-template #noActionToShow>
      <p>No action to review.</p>
    </ng-template>
  </ng-template>
</div>